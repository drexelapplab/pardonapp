{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{119:function(e,n){function t(e){var n=new Error('Cannot find module \"'+e+'\".');throw n.code=\"MODULE_NOT_FOUND\",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=119},151:function(e,n,t){const s=t(!function(){var e=new Error('Cannot find module \"../config/config\"');throw e.code=\"MODULE_NOT_FOUND\",e}()),o=t(159),r=t(266),a=t(265).User;e.exports={authenticate:async function({username:e,password:n}){const t=await a.findOne({username:e});if(t&&r.compareSync(n,t.hash)){const{hash:e,...n}=t.toObject(),r=o.sign({sub:t.id},s.secret);return{...n,token:r}}},getAll:async function(){return await a.find().select(\"-hash\")},getById:async function(e){return await a.findById(e).select(\"-hash\")},create:async function(e){if(await a.findOne({username:e.username}))throw'Username \"'+e.username+'\" is already taken';const n=new a(e);e.password&&(n.hash=r.hashSync(e.password,10));await n.save()},update:async function(e,n){const t=await a.findById(e);if(!t)throw\"User not found\";if(t.username!==n.username&&await a.findOne({username:n.username}))throw'Username \"'+n.username+'\" is already taken';n.password&&(n.hash=r.hashSync(n.password,10));Object.assign(t,n),await t.save()},delete:async function(e){await a.findByIdAndRemove(e)}}},262:function(e,n,t){t(!function(){var e=new Error('Cannot find module \"../config/config\"');throw e.code=\"MODULE_NOT_FOUND\",e}());const s=t(150).Router(),o=t(151);s.post(\"/authenticate\",function(e,n,t){o.authenticate(e.body).then(e=>e?n.json(e):n.status(400).json({message:\"Username or password is incorrect\"})).catch(e=>t(e))}),s.post(\"/register\",function(e,n,t){o.create(e.body).then(()=>n.json({})).catch(e=>t(e))}),s.get(\"/\",function(e,n,t){o.getAll().then(e=>n.json(e)).catch(e=>t(e))}),s.get(\"/:id\",function(e,n,t){o.getById(e.params.id).then(e=>e?n.json(e):n.sendStatus(404)).catch(e=>t(e))}),s.get(\"/current\",function(e,n,t){o.getById(e.params.sub).then(e=>e?n.json(e):n.sendStatus(404)).catch(e=>t(e))}),s.put(\"/:id\",function(e,n,t){o.update(e.params.id,e.body).then(()=>n.json({})).catch(e=>t(e))}),s.delete(\"/:id\",function(e,n,t){o.delete(e.params.id).then(()=>n.json({})).catch(e=>t(e))}),e.exports=s},263:function(e,n){e.exports=function(e,n,t,s){if(\"string\"==typeof e)return t.status(400).json({message:e});if(\"ValidationError\"===e.name)return t.status(400).json({message:e.message});if(\"UnauthorizedError\"===e.name)return t.status(401).json({message:\"Invalid Token\"});return t.status(500).json({message:e.message})}},264:function(e,n,t){const s=t(86),o=new(0,s.Schema)({username:{type:String,unique:!0,required:!0},hash:{type:String,required:!0},firstName:{type:String,required:!0},lastName:{type:String,required:!0},createdDate:{type:Date,default:Date.now}});o.set(\"toJSON\",{virtuals:!0}),e.exports=s.model(\"User\",o)},265:function(e,n,t){(function(n){const s=t(!function(){var e=new Error('Cannot find module \"./config\"');throw e.code=\"MODULE_NOT_FOUND\",e}()),o=t(86);o.connect(s.connectionString),o.Promise=n.Promise,e.exports={User:t(264),database:\"mongodb://localhost:27017/home\"}}).call(this,t(9))},267:function(e){e.exports={connectionString:\"mongodb://localhost/node-mongo-registration-login-api\",secret:\"4av601vt99rfg7knag2q\"}},288:function(e,n,t){const s=t(287),o=t(267),r=t(151);async function a(e,n,t){if(!await r.getById(n.sub))return t(null,!0);t()}e.exports=function(){const e=o.secret;return s({secret:e,isRevoked:a}).unless({path:[\"/home\",\"/users/authenticate\",\"/users/register\"]})}},289:function(e,n,t){let s=t(86),o=s.Schema({title:{type:String,required:!0},description:String,category:String});const r=e.exports=s.model(\"UserData\",o);e.exports.getAllUsers=(e=>{r.find(e)}),e.exports.addUser=((e,n)=>{e.save(n)}),e.exports.deleteUserById=((e,n)=>{let t={_id:e};r.remove(t,n)})},290:function(e,n,t){const s=t(150).Router(),o=t(289);s.get(\"/\",(e,n)=>{o.getAllUsers((e,t)=>{e?n.json({success:!1,message:`Failed to load all user data. Error: ${e}`}):(n.write(JSON.stringify({success:!0,lists:t},null,2)),n.end())})}),s.post(\"/\",(e,n,t)=>{let s=new o({title:e.body.title,description:e.body.description,category:e.body.category});o.addUser(s,(e,t)=>{e?n.json({success:!1,message:`Failed to create a new user. Error: ${e}`}):n.json({success:!0,message:\"Added successfully.\"})})}),s.delete(\"/:id\",(e,n,t)=>{let s=e.params.id;o.deleteUserById(s,(e,t)=>{e?n.json({success:!1,message:`Failed to delete the user. Error: ${e}`}):t?n.json({success:!0,message:\"Deleted successfully\"}):n.json({success:!1})})}),e.exports=s},329:function(e,n){function t(e){var n=new Error('Cannot find module \"'+e+'\".');throw n.code=\"MODULE_NOT_FOUND\",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=329},379:function(e,n){},380:function(e,n){},461:function(e,n){},462:function(e,n){},494:function(e,n){},496:function(e,n){},499:function(e,n){function t(e){var n=new Error('Cannot find module \"'+e+'\".');throw n.code=\"MODULE_NOT_FOUND\",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=499},502:function(e,n){},539:function(e,n){},541:function(e,n){},573:function(e,n,t){(function(e){const n=t(150),s=t(398),o=t(372),r=t(86),a=n(),i=t(25),c=t(290),u=t(288);t(263);r.connect(\"mongodb://ryanwon7:maplenets8@ds253831.mlab.com:53831/pardon-app-testing\",{useNewUrlParser:!0}),a.use(o()),a.use(s.urlencoded({extended:!0})),a.use(s.json()),a.use(\"/users\",t(262)),a.use(u()),a.use(\"home\",c),a.use(n.static(i.join(e,\"public\"))),a.get(\"/\",(e,n)=>{n.send(\"Invalid page\")});a.listen(80,function(){console.log(\"Server listening on port 80\")});a.use(\"/home\",c)}).call(this,\"/\")}},[[573,0,1]]]);","extractedComments":[]}